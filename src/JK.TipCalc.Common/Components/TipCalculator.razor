@page "/"

<div class="calc-container">
    @if (this.ViewModel is null || this.ViewModel.Tips.Items is null)
    {
        <p>Loading...</p>
    }
    else
    {
        <EditForm Model="this.ViewModel">
            <div class="row justify-content-sm-center text-start">
                <div class="col">
                    <label for="bill-amount" class="form-label">Amount</label>
                    <div class="input-group">
                        <span class="input-group-text">$</span>
                        <InputDecimal id="bill-amount" @bind-Value="this.ViewModel.Amount"
                                      placeholder="0.00" class="form-control" min="0" step="0.1" />
                    </div>
                </div>
                <div class="col">
                    <label for="bill-discount" class="form-label">Discount</label>
                    <div class="input-group">
                        <span class="input-group-text">$</span>
                        <InputDecimal id="bill-discount" @bind-Value="this.ViewModel.Discount"
                                      placeholder="0.00" class="form-control" min="0" step="0.1" />
                    </div>
                    <div class="form-text text-start"><small>Add Gift Cards, etc.</small></div>
                </div>
            </div>
        </EditForm>

        <div class="card bg-transparent border border-2 my-2 p-2">
            <div class="text-start fw-bold">Custom Tip:</div>
            <div class="text-end"><span class="fw-bold">Tip:</span> $@($"{this.ViewModel.CustomTip.TipAmount:##0.00}")</div>
            <div class="text-end"><span class="fw-bold">Total:</span> $@($"{this.ViewModel.CustomTip.Total:##0.00}")</div>
            <div class="container">
                <div class="row">
                    <div class="col-12 col-sm-4">
                        <div class="input-group input-group-sm">
                            <input id="custom-percent" type="number" placeholder="custom percent"
                                   value="@this.ViewModel.CustomTip.Percent" class="form-control"
                                   @oninput="@this.HandleCustomTipAmountChanged" />
                            <span class="input-group-text">%</span>
                        </div>
                    </div>
                    <div class="col d-flex" id="input-range-container">
                        <input class="w-100" type="range" min="1" max="50" step="1"
                               value="@this.ViewModel.CustomTip.Percent"
                               @oninput="@this.HandleCustomTipAmountChanged" />
                    </div>
                </div>
            </div>
        </div>


        <div class="text-center mb-2">
            <button type="button" class="btn btn-secondary" @onclick="this.ViewModel.RoundDown" title="Round Down">
                Round <i class="bi bi-arrow-down-circle"></i><span class="visually-hidden">Up</span>
            </button>
            <button type="button" class="btn btn-danger" @onclick="this.ViewModel.Reset" title="Reset">
                Reset <i class="bi bi-arrow-clockwise"></i>
            </button>
            <button type="button" class="btn btn-secondary" @onclick="this.ViewModel.RoundUp" title="Round Up">
                Round <i class="bi bi-arrow-up-circle"></i><span class="visually-hidden">Down</span>
            </button>
        </div>

        <table class="w-100" border="1">
            @for (int i = 0; i < this.ViewModel.Tips.Items.Count - 1; i++)
            {
                var calc = this.ViewModel.Tips.Items[i];
                <tr class="vertical">
                    <td class="text-center fw-bold" style="background-color: var(--theme-color);">@($"{calc.Percent}")%</td>
                    <td class="text-center"><div class="fw-bold">Tip:</div> $@($"{calc.TipAmount:##0.00}")</td>
                    <td class="text-center"><div class="fw-bold">Total:</div> $@($"{calc.Total:##0.00}")</td>
                </tr>
            }
        </table>

        @if (this.ViewModel.HasErrors)
        {
            <div class="alert alert-danger text-start mt-3">
                <ul>
                    @foreach (var error in this.ViewModel.Errors)
                    {
                        <li>@error</li>

                    }
                </ul>
            </div>
        }
    }
</div>